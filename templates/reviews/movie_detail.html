{% extends 'reviews/base.html' %}

{% block content %}
<div class="container">
    <div class="movie-detail">
        <div class="movie-header">
            {% if movie.poster %}
                <img src="{{ movie.poster.url }}" alt="{{ movie.title }}" class="movie-poster-large">
            {% endif %}
            <div class="movie-info-detail">
                <h1>{{ movie.title }}</h1>
                <p><strong>Director:</strong> {{ movie.director }}</p>
                <p><strong>Genre:</strong> {{ movie.get_genre_display }}</p>
                <p><strong>Release Date:</strong> {{ movie.release_date }}</p>
                <div class="rating-display">
                    <span class="rating-score">‚≠ê {{ movie.average_rating }}/10</span>
                </div>
                {% if user.is_authenticated %}
                    <a href="{% url 'add_rating' movie.pk %}" class="btn">Rate This Movie</a>
                    <a href="{% url 'add_review' movie.pk %}" class="btn">Write a Review</a>
                {% endif %}
            </div>
        </div>

        <div class="movie-description">
            <h2>Description</h2>
            <p>{{ movie.description }}</p>
        </div>

        <div class="reviews-section">
            <h2>Reviews</h2>
            {% for review in reviews %}
                <div class="review-card">
                    <h3>{{ review.title }}</h3>
                    <p class="review-meta">By {{ review.user.username }} on {{ review.created_at|date:"M d, Y" }}</p>
                    <p>{{ review.content }}</p>
                    
                    {% if review.comments.all %}
                        <div class="comments">
                            <h4>Comments:</h4>
                            {% for comment in review.comments.all %}
                                <div class="comment">
                                    <strong>{{ comment.user.username }}:</strong> {{ comment.content }}
                                </div>
                            {% endfor %}
                        </div>
                    {% endif %}
                    
                    {% if user.is_authenticated %}
                        <form method="post" action="{% url 'add_comment' review.pk %}">
                            {% csrf_token %}
                            <input type="text" name="content" placeholder="Add a comment..." required>
                            <button type="submit" class="btn-small">Comment</button>
                        </form>
                    {% endif %}
                </div>
            {% empty %}
                <p>No reviews yet. Be the first to review!</p>
            {% endfor %}
        </div>
    </div>
</div>
{% endblock %}